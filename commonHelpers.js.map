{"version":3,"file":"commonHelpers.js","sources":["../src/js/card.js"],"sourcesContent":["import sprite from '../images/icons.svg';\nimport { createNewOrder } from './get-api';\n\nconst STORAGE_KEY = 'added-item';\nlet dataForm = [];\nlet hiddenElements = [];\n\nconst itemCount = document.querySelector('.js-item-count');\nconst emptyBasket = document.querySelector('.js-empty-basket');\nconst filledBasket = document.querySelector('.js-filled-basket');\nconst itemsContainer = document.querySelector('.js-items-container');\nconst totalSum = document.querySelector('.total-count-text');\nconst checkoutForm = document.querySelector('.js-checkout-form');\nconst itemButton = document.querySelector('.js-item-button');\nconst headerCount = document.querySelector('#countProducts');\nconst modalInfo = {};\n\ncheckoutForm.addEventListener('submit', onOrderSubmit);\nitemButton.addEventListener('click', onClick);\n\nonLoad();\n\nfunction onLoad() {\n  try {\n    changeCategory();\n    countAddedItems(dataForm);\n    checkLoadCount();\n    itemsContainer.innerHTML = basketItemsMarkup(dataForm, hiddenElements);\n\n    totalSumCount(dataForm);\n    // totalSum.textContent = `$${totalSumCount(dataForm)}`;\n  } catch (error) {\n    // add notifix message about something wrong\n    console.log(error.message);\n  }\n}\n\nfunction getLocalStorageData() {\n  const data = localStorage.getItem(STORAGE_KEY);\n  if (!data) return;\n  dataForm = JSON.parse(data);\n}\nfunction updateItemCount(item, count) {\n  for (let i = 0; i <= dataForm.length; i += 1) {\n    const { _id: itemId } = dataForm[i];\n    if (itemId === item) {\n      dataForm[i].count = count;\n      updateLocalStorageData(dataForm);\n      return;\n    }\n  }\n}\n\nfunction checkLoadCount() {\n  hiddenElements = [];\n  dataForm.forEach(element => {\n    if (element.count < 2  || element.count === undefined ) {\n      hiddenElements.push({ hide: 'hide', disabled: 'disabled' });\n    } else {\n      hiddenElements.push({ hide: '', disabled: '' });\n    }\n  });\n  console.log(hiddenElements);\n}\n\n// ------- Created Category without \"_\"\n\nexport function changeCategory() {\n  getLocalStorageData();\n  dataForm.forEach(element => {\n    element.category = element.category.split('_').join(' ');\n    updateLocalStorageData(dataForm);\n  });\n}\n\nfunction onClick(event) {\n  const clickTarget = event.target.closest('button');\n  if (!clickTarget) {\n    return;\n  }\n  const itemTarget = clickTarget.attributes.class.value;\n\n  switch (itemTarget) {\n    case 'basket-clear-container':\n      clearBasket();\n      break;\n    case 'delete-item-button':\n      const itemId = idDetect(event);\n      deleteSelectedItem(itemId);\n      getLocalStorageData();\n      itemsContainer.innerHTML = basketItemsMarkup(dataForm, hiddenElements);\n      break;\n    case 'decrease-button':\n      if (!true) {\n      }\n      counterItem(event, -1);\n      break;\n    case 'increase-button':\n      counterItem(event, 1);\n      break;\n    default:\n  }\n}\n\nfunction clearBasket() {\n  dataForm = [];\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(dataForm));\n  countAddedItems(dataForm);\n}\nfunction deleteSelectedItem(item) {\n  for (let i = 0; i <= dataForm.length; i += 1) {\n    const { _id: itemId } = dataForm[i];\n    if (itemId === item) {\n      dataForm.splice(i, 1);\n      updateLocalStorageData(dataForm);\n      countAddedItems(dataForm);\n      totalSumCount(dataForm);\n      return;\n    }\n  }\n}\n\nfunction countAddedItems(item) {\n  itemCount.textContent = item.length;\n  headerCount.textContent = `Cart (${item.length})`;\n  isBasketEmpty(item.length);\n}\n\nfunction idDetect(event) {\n  const parentItem = event.target.closest('li');\n  return parentItem.dataset.id;\n}\n\nfunction counterItem(event, increment) {\n  try {\n    const itemId = idDetect(event);\n    const parentItem = event.target.closest('div');\n    let item = Number(parentItem.children.counter.textContent) + increment;\n    parentItem.children.counter.textContent = item;\n    updateItemCount(itemId, item);\n    totalSumCount(dataForm);\n    // totalSum.textContent = `$${totalSumCount(dataForm)}`;\n    if (item <= 1) {\n      lockDecrese(parentItem);\n      return;\n    }\n    unlockDecrese(parentItem);\n  } catch (error) {\n    // add notifix message about something wrong\n    console.log(error.message);\n  }\n}\n\nfunction lockDecrese(parentItem) {\n  parentItem.children.decrease.children[0].classList.add('hide');\n  parentItem.children.decrease.disabled = true;\n}\nfunction unlockDecrese(parentItem) {\n  parentItem.children.decrease.children[0].classList.remove('hide');\n  parentItem.children.decrease.disabled = false;\n}\n\nfunction updateLocalStorageData(dataForm) {\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(dataForm));\n}\n\nfunction isBasketEmpty(itemAdded) {\n  if (itemAdded === 0) {\n    emptyBasket.classList.remove('hide');\n    filledBasket.classList.add('hide');\n    return;\n  } else {\n    emptyBasket.classList.add('hide');\n    filledBasket.classList.remove('hide');\n  }\n}\n\nfunction basketItemsMarkup(array, hiddenArr) {\n  for (let i = 0; i < array.length; i += 1) {\n    array[i].hide = hiddenArr[i].hide;\n    array[i].disabled = hiddenArr[i].disabled;\n  }\n  return array\n    .map(\n      ({\n        _id: id,\n        name,\n        img,\n        category,\n        size,\n        is10PercentOff,\n        price,\n        count = 1,\n        hide = '',\n        disabled = '',\n      }) =>\n        `<li class=\"item-container\" data-id=\"${id}\">\n          <div class=\"item-img-link\">\n            <img class=\"item-img\" src=\"${img}\" alt=\"${name}\" loading=\"lazy\" />\n          </div>\n          <div class=\"item-info\">\n            <div class=\"item-title-container\">\n              <h4 class=\"item-title\">${name}</h4>\n              <button type=\"button\" class=\"delete-item-button\">\n                <svg class=\"delete-item-icon\" width=\"20\" height=\"20\">\n                  <use href=\"${sprite}#delete-icon\"></use>\n                </svg>\n              </button>\n            </div>\n            <ul class=\"item-parameter-list\">\n              <li class=\"item-category\">Category:</li>\n              <li class=\"item-parameter\">${category}</li>\n              <li class=\"item-category\">Size:</li>\n              <li class=\"item-parameter\">${size}</li>\n            </ul>\n            <div class=\"total-item-container\">\n              <p class=\"item-price\">$${price}</p>\n              <div class=\"item-counter-container\">\n                <button class=\"decrease-button\" ${disabled} name=\"decrease\" type=\"button\">\n                  <svg class=\"decrease-icon ${hide}\" width=\"18\" height=\"18\">\n                    <use href=\"${sprite}#minus\"></use>\n                  </svg>\n                </button>\n                <p class=\"item-counter\" name=\"counter\">${count}</p>\n                <button class=\"increase-button\" name=\"increase\" type=\"button\">\n                  <svg class=\"increase-icon\" width=\"18\" height=\"18\">\n                    <use href=\"${sprite}#plus\"></use>\n                  </svg>\n                </button>\n              </div>\n            </div>\n          </div>\n        </li>\n        `\n    )\n    .join('');\n}\n\nfunction totalSumCount(array) {\n  let totalPrice = 0;\n  array.forEach(({ price, count = 1 }) => {\n    totalPrice += price * count;\n  });\n  totalSum.textContent = `$${totalPrice.toFixed(2)}`;\n}\n\n//  Email validation\nconst EMAIL_REGEXP =\n  /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@(([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{2,})$/iu;\n\nasync function onOrderSubmit(event) {\n  try {\n    event.preventDefault();\n    const email = event.target.elements.email.value;\n    console.log(isEmailValid(email));\n    if (!isEmailValid(email)) {\n      console.dir(email);\n      throw new Error(`Your E-mail is not valid`);\n    }\n    let order = [];\n    dataForm.forEach(({ _id: productId, count: amount = 1 }) => {\n      order.push({ productId, amount });\n    });\n    const apiResponse = await createNewOrder(email, order);\n    success(apiResponse);\n  } catch (error) {\n    onError(error);\n  }\n}\n\nfunction isEmailValid(value) {\n  return EMAIL_REGEXP.test(value);\n}\n// ------- order to Modal window\n\nfunction success(response) {\n  console.dir(modalInfo);\n  modalInfo.message = response.message;\n  modalInfo.title = 'Order success';\n  modalInfo.image = './images/success_order.png';\n  createModalMarkup(modalInfo);\n  openModalWindow();\n  resetCart();\n}\n\nfunction onError(response) {\n  modalInfo.message = response.message;\n  modalInfo.title = 'Something went wrong';\n  modalInfo.image = './images/error.png';\n  createModalMarkup(modalInfo);\n  openModalWindow();\n}\n\n// ------- Modal window\n\nfunction createModalMarkup(event) {\n  modalWindow.innerHTML = `<img class=\"modal-img\" src=\"${event.image}\" alt=\"${event.title}\">\n      <div class=\"modal-title-message\">${event.title}</div>\n      <div class=\"modal-text\">${event.message}</div>`;\n}\n\nconst openModalBtn = document.querySelector('[js-modal-open]');\nconst closeModalBtn = document.querySelector('[data-modal-close]');\nconst modal = document.querySelector('[data-modal]');\nconst modalWindow = document.querySelector('#js-modal-info');\nconst backdrop = document.querySelector('.backdrop');\n\nfunction openModalWindow() {\n  try {\n    openModalBtn.addEventListener('click', toggleModal);\n    backdrop.addEventListener('click', toggleModal);\n    document.addEventListener('keydown', escClick);\n    closeModalBtn.addEventListener('click', toggleModal);\n  } catch (error) {\n    onError(error);\n  }\n}\nfunction toggleModal() {\n  document.removeEventListener('keydown', escClick);\n  backdrop.removeEventListener('click', toggleModal);\n  modal.classList.toggle('is-hidden');\n  modalWindow.innerHTML = '';\n}\nfunction escClick(event) {\n  if (event.code === 'Escape') {\n    backdrop.removeEventListener('click', toggleModal);\n    document.removeEventListener('keydown', escClick);\n    modal.classList.toggle('is-hidden');\n    modalWindow.innerHTML = '';\n  }\n}\nfunction resetCart() {\n  clearBasket();\n  checkoutForm.reset();\n}\n\nopenModalWindow(modalInfo);\n"],"names":["STORAGE_KEY","dataForm","hiddenElements","itemCount","emptyBasket","filledBasket","itemsContainer","totalSum","checkoutForm","itemButton","headerCount","modalInfo","onOrderSubmit","onClick","onLoad","changeCategory","countAddedItems","checkLoadCount","basketItemsMarkup","totalSumCount","error","getLocalStorageData","data","updateItemCount","item","count","i","itemId","updateLocalStorageData","element","event","clickTarget","clearBasket","idDetect","deleteSelectedItem","counterItem","isBasketEmpty","increment","parentItem","lockDecrese","unlockDecrese","itemAdded","array","hiddenArr","id","name","img","category","size","is10PercentOff","price","hide","disabled","sprite","totalPrice","EMAIL_REGEXP","email","isEmailValid","order","productId","amount","apiResponse","createNewOrder","success","onError","value","response","createModalMarkup","openModalWindow","resetCart","modalWindow","openModalBtn","closeModalBtn","modal","backdrop","toggleModal","escClick"],"mappings":"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"}