{"version":3,"file":"commonHelpers.js","sources":["../src/images/success_order.png","../src/images/error.png","../src/js/card.js"],"sourcesContent":["export default \"__VITE_ASSET__f37e250d__\"","export default \"__VITE_ASSET__365e533b__\"","import sprite from '../images/icons.svg';\nimport { createNewOrder } from './get-api';\nimport successImg from '../images/success_order.png';\nimport errorImg from '../images/error.png';\nimport { STORAGE_KEY, getData, saveData } from './STORAGE';\n\nlet dataForm = [];\nlet hiddenElements = [];\nconst modalInfo = {};\n\nconst itemCount = document.querySelector('.js-item-count');\nconst emptyBasket = document.querySelector('.js-empty-basket');\nconst filledBasket = document.querySelector('.js-filled-basket');\nconst itemsContainer = document.querySelector('.js-items-container');\nconst totalSum = document.querySelector('.total-count-text');\nconst checkoutForm = document.querySelector('.js-checkout-form');\nconst itemButton = document.querySelector('.js-item-button');\nconst headerCount = document.querySelector('#countProducts');\n\ncheckoutForm.addEventListener('submit', onOrderSubmit);\nitemButton.addEventListener('click', onClick);\n\nonLoad();\n\nfunction onLoad() {\n  try {\n    changeCategory();\n    countAddedItems(dataForm);\n    checkLoadCount();\n    itemsContainer.innerHTML = basketItemsMarkup(dataForm, hiddenElements);\n    totalSumCount(dataForm);\n  } catch (error) {\n    onError(error);\n  }\n}\n\nfunction updateItemCount(item, count) {\n  for (let i = 0; i <= dataForm.length; i += 1) {\n    const { _id: itemId } = dataForm[i];\n    if (itemId === item) {\n      dataForm[i].count = count;\n      saveData(STORAGE_KEY, dataForm);\n      return;\n    }\n  }\n}\n\nfunction checkLoadCount() {\n  hiddenElements = [];\n  dataForm.forEach(element => {\n    if (element.count < 2 || element.count === undefined) {\n      hiddenElements.push({ hide: 'hide', disabled: 'disabled' });\n    } else {\n      hiddenElements.push({ hide: '', disabled: '' });\n    }\n  });\n}\n\nexport function changeCategory() {\n  dataForm = getData(STORAGE_KEY);\n  dataForm.forEach(element => {\n    element.category = element.category.split('_').join(' ');\n    saveData(STORAGE_KEY, dataForm);\n  });\n}\n\nfunction onClick(event) {\n  const clickTarget = event.target.closest('button');\n  if (!clickTarget) {\n    return;\n  }\n  const itemTarget = clickTarget.attributes.class.value;\n  switch (itemTarget) {\n    case 'basket-clear-container':\n      clearBasket();\n      break;\n    case 'delete-item-button':\n      const itemId = idDetect(event);\n      deleteSelectedItem(itemId);\n      getData(STORAGE_KEY);\n      itemsContainer.innerHTML = basketItemsMarkup(dataForm, hiddenElements);\n      break;\n    case 'decrease-button':\n      if (!true) {\n      }\n      counterItem(event, -1);\n      break;\n    case 'increase-button':\n      counterItem(event, 1);\n      break;\n    default:\n  }\n}\n\nfunction clearBasket() {\n  dataForm = [];\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(dataForm));\n  countAddedItems(dataForm);\n}\nfunction deleteSelectedItem(item) {\n  for (let i = 0; i <= dataForm.length; i += 1) {\n    const { _id: itemId } = dataForm[i];\n    if (itemId === item) {\n      dataForm.splice(i, 1);\n      saveData(STORAGE_KEY, dataForm);\n      countAddedItems(dataForm);\n      totalSumCount(dataForm);\n      return;\n    }\n  }\n}\n\nexport function countAddedItems(item) {\n  if (itemCount) {\n    itemCount.textContent = item.length;\n  }\n  headerCount.textContent = `Cart (${item.length})`;\n  isBasketEmpty(item.length);\n}\n\nfunction idDetect(event) {\n  const parentItem = event.target.closest('li');\n  return parentItem.dataset.id;\n}\n\nfunction counterItem(event, increment) {\n  try {\n    const itemId = idDetect(event);\n    const parentItem = event.target.closest('div');\n    let item = Number(parentItem.children.counter.textContent) + increment;\n    parentItem.children.counter.textContent = item;\n    updateItemCount(itemId, item);\n    totalSumCount(dataForm);\n    if (item <= 1) {\n      lockDecrese(parentItem);\n      return;\n    }\n    unlockDecrese(parentItem);\n  } catch (error) {\n    onError(error);\n  }\n}\n\nfunction lockDecrese(parentItem) {\n  parentItem.children.decrease.children[0].classList.add('hide');\n  parentItem.children.decrease.disabled = true;\n}\nfunction unlockDecrese(parentItem) {\n  parentItem.children.decrease.children[0].classList.remove('hide');\n  parentItem.children.decrease.disabled = false;\n}\n\nfunction isBasketEmpty(itemAdded) {\n  if (itemAdded === 0) {\n    emptyBasket.classList.remove('hide');\n    filledBasket.classList.add('hide');\n    return;\n  } else {\n    emptyBasket.classList.add('hide');\n    filledBasket.classList.remove('hide');\n  }\n}\n\nfunction basketItemsMarkup(array, hiddenArr) {\n  for (let i = 0; i < array.length; i += 1) {\n    array[i].hide = hiddenArr[i].hide;\n    array[i].disabled = hiddenArr[i].disabled;\n  }\n  return array\n    .map(\n      ({\n        _id: id,\n        name,\n        img,\n        category,\n        size,\n        is10PercentOff,\n        price,\n        count = 1,\n        hide = '',\n        disabled = '',\n      }) =>\n        `<li class=\"item-container\" data-id=\"${id}\">\n          <div class=\"item-img-link\">\n            <img class=\"item-img\" src=\"${img}\" alt=\"${name}\" loading=\"lazy\" />\n          </div>\n          <div class=\"item-info\">\n            <div class=\"item-title-container\">\n              <h4 class=\"item-title\">${name}</h4>\n              <button type=\"button\" class=\"delete-item-button aria-label=\"Delete\"\">\n                <svg class=\"delete-item-icon\" width=\"20\" height=\"20\">\n                  <use href=\"${sprite}#delete-icon\"></use>\n                </svg>\n              </button>\n            </div>\n            <ul class=\"item-parameter-list\">\n              <li class=\"item-category\">Category:</li>\n              <li class=\"item-parameter\">${category}</li>\n              <li class=\"item-category\">Size:</li>\n              <li class=\"item-parameter\">${size}</li>\n            </ul>\n            <div class=\"total-item-container\">\n              <p class=\"item-price\">$${price}</p>\n              <div class=\"item-counter-container\">\n                <button class=\"decrease-button\" ${disabled} name=\"decrease\" type=\"button aria-label=\"decrease\"\">\n                  <svg class=\"decrease-icon ${hide}\" width=\"18\" height=\"18\">\n                    <use href=\"${sprite}#minus\"></use>\n                  </svg>\n                </button>\n                <p class=\"item-counter\" name=\"counter\">${count}</p>\n                <button class=\"increase-button\" name=\"increase\" type=\"button\" aria-label=\"increase\">\n                  <svg class=\"increase-icon\" width=\"18\" height=\"18\">\n                    <use href=\"${sprite}#plus\"></use>\n                  </svg>\n                </button>\n              </div>\n            </div>\n          </div>\n        </li>\n        `\n    )\n    .join('');\n}\n\nfunction totalSumCount(array) {\n  let totalPrice = 0;\n  array.forEach(({ price, count = 1 }) => {\n    totalPrice += price * count;\n  });\n  totalSum.textContent = `$${totalPrice.toFixed(2)}`;\n}\n\nconst EMAIL_REGEXP =\n  /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@(([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{2,})$/iu;\n\nasync function onOrderSubmit(event) {\n  try {\n    event.preventDefault();\n    const email = event.target.elements.email.value;\n    if (!isEmailValid(email)) {\n      throw new Error(`Your E-mail is not valid`);\n    }\n    let order = [];\n    dataForm.forEach(({ _id: productId, count: amount = 1 }) => {\n      order.push({ productId, amount });\n    });\n    const apiResponse = await createNewOrder(email, order);\n    success(apiResponse);\n  } catch (error) {\n    onError(`Your E-mail is not valid`);\n  }\n}\n\nfunction isEmailValid(value) {\n  return EMAIL_REGEXP.test(value);\n}\n\nfunction success(response) {\n  console.dir(modalInfo);\n  modalInfo.message = response.message;\n  modalInfo.title = 'Order success';\n  modalInfo.image = successImg;\n  createModalMarkup(modalInfo);\n  lockScroll();\n  openModalWindow();\n  resetCart();\n}\n\nfunction onError() {\n  modalInfo.message = 'Sorry, Update page and try again...';\n  modalInfo.title = 'Something went wrong';\n  modalInfo.image = errorImg;\n  createModalMarkup(modalInfo);\n  lockScroll();\n  openModalWindow();\n}\n\nfunction createModalMarkup(event) {\n  modalWindow.innerHTML = `<img class=\"modal-img\" src=\"${event.image}\" alt=\"${event.title}\">\n      <div class=\"modal-title-message\">${event.title}</div>\n      <div class=\"modal-text\">${event.message}</div>`;\n}\n\nconst openModalBtn = document.querySelector('[data-js-modal-open]');\nconst closeModalBtn = document.querySelector('[data-modal-close]');\nconst modal = document.querySelector('[data-modal]');\nconst modalWindow = document.querySelector('#js-modal-info');\nconst backdrop = document.querySelector('.backdrop');\n\nfunction openModalWindow() {\n  try {\n    openModalBtn.addEventListener('click', toggleModal);\n    backdrop.addEventListener('click', toggleModal);\n    document.addEventListener('keydown', escClick);\n    closeModalBtn.addEventListener('click', toggleModal);\n  } catch (error) {\n    onError(error);\n  }\n}\nfunction toggleModal() {\n  document.removeEventListener('keydown', escClick);\n  backdrop.removeEventListener('click', toggleModal);\n  modal.classList.toggle('is-hidden');\n  unlockScroll();\n  modalWindow.innerHTML = '';\n}\nfunction escClick(event) {\n  if (event.code === 'Escape') {\n    toggleModal();\n  }\n}\n\nfunction lockScroll() {\n  document.body.style.overflow = 'hidden';\n}\nfunction unlockScroll() {\n  document.body.style.overflow = '';\n}\n\nfunction resetCart() {\n  clearBasket();\n  checkoutForm.reset();\n}\n\nopenModalWindow(modalInfo);\n"],"names":["successImg","errorImg","dataForm","hiddenElements","modalInfo","itemCount","emptyBasket","filledBasket","itemsContainer","totalSum","checkoutForm","itemButton","headerCount","onOrderSubmit","onClick","onLoad","changeCategory","countAddedItems","checkLoadCount","basketItemsMarkup","totalSumCount","onError","updateItemCount","item","count","i","itemId","saveData","STORAGE_KEY","element","getData","event","clickTarget","clearBasket","idDetect","deleteSelectedItem","counterItem","isBasketEmpty","increment","parentItem","lockDecrese","unlockDecrese","itemAdded","array","hiddenArr","id","name","img","category","size","is10PercentOff","price","hide","disabled","sprite","totalPrice","EMAIL_REGEXP","email","isEmailValid","order","productId","amount","apiResponse","createNewOrder","success","value","response","createModalMarkup","lockScroll","openModalWindow","resetCart","modalWindow","openModalBtn","closeModalBtn","modal","backdrop","toggleModal","escClick","unlockScroll"],"mappings":"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"}